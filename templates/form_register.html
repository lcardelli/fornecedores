<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Fornecedor</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="stylesheet" href="/static/css/dashboard.css">
    <link rel="stylesheet" href="/static/css/sidebar.css">
    <link rel="stylesheet" href="/static/css/header.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css">
</head>
<body>
    {{ template "header.html" . }}
    <div class="container-fluid">
        <div class="row">
            {{ template "sidebar.html" . }}
            
            <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">Cadastro de Fornecedor</h1>
                </div>
                
                <form id="supplierForm" action="/api/v1/suppliers" method="POST">
                    <div class="form-group">
                        <label for="name"><i class="fas fa-user mr-2"></i>Nome:</label>
                        <input type="text" class="form-control" id="name" name="name" required>
                    </div>

                    <div class="form-group">
                        <label for="email"><i class="fas fa-envelope mr-2"></i>E-mail:</label>
                        <input type="email" class="form-control" id="email" name="email" required>
                    </div>

                    <div class="form-group">
                        <label for="phone"><i class="fas fa-phone mr-2"></i>Telefone:</label>
                        <input type="tel" class="form-control" id="phone" name="phone" required>
                    </div>

                    <div class="form-group">
                        <label for="address"><i class="fas fa-map-marker-alt mr-2"></i>Endereço:</label>
                        <input type="text" class="form-control" id="address" name="address" required>
                    </div>

                    <div class="form-group">
                        <label for="cnpj"><i class="fas fa-id-card mr-2"></i>CNPJ:</label>
                        <input type="text" class="form-control" id="cnpj" name="cnpj" required>
                    </div>

                    <div class="form-group">
                        <label for="category_id"><i class="fas fa-tags mr-2"></i>Categoria:</label>
                        <select class="form-control" id="category_id" name="category_id" required>
                            <option value="">Selecione uma categoria</option>
                            {{ range .Categories }}
                                <option value="{{ .ID }}">{{ .Name }}</option>
                            {{ end }}
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="service_ids"><i class="fas fa-cogs mr-2"></i>Serviços:</label>
                        <select multiple class="form-control select2" id="service_ids" name="service_ids[]" required>
                            {{ range .Services }}
                                <option value="{{ .ID }}">{{ .Name }}</option>
                            {{ end }}
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="description"><i class="fas fa-comment mr-2"></i>Descrição:</label>
                        <textarea class="form-control" id="description" name="description" rows="4"></textarea>
                    </div>

                    <button type="submit" class="btn btn-primary"><i class="fas fa-save mr-2"></i>Cadastrar Fornecedor</button>
                </form>
            </main>
        </div>
    </div>

    <!-- Modal de Sucesso -->
    <div class="modal fade" id="successModal" tabindex="-1" role="dialog" aria-labelledby="successModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title" id="successModalLabel"><i class="fas fa-check-circle mr-2"></i>Sucesso!</h5>
                    <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>Fornecedor cadastrado com sucesso!</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
                    <button type="button" class="btn btn-primary" id="newSupplierBtn">Cadastrar Novo Fornecedor</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
    <script src="/static/js/form-validation.js"></script>
    <script>
        $(document).ready(function() {
            $('.select2').select2({
                theme: 'bootstrap-5',
                placeholder: "Selecione um ou mais serviços",
                allowClear: true
            });

            $('#phone').mask('(00) 00000-0000');
            $('#cnpj').mask('00.000.000/0000-00');

            $('#category_id').change(function() {
                var categoryId = $(this).val();
                if (categoryId) {
                    $.ajax({
                        url: '/api/services-by-category/' + categoryId,
                        type: 'GET',
                        success: function(data) {
                            var serviceSelect = $('#service_ids');
                            serviceSelect.empty();
                            $.each(data, function(index, service) {
                                serviceSelect.append(new Option(service.Name, service.ID));
                            });
                            serviceSelect.trigger('change');
                        }
                    });
                }
            });
        });
    </script>
</body>
</html>
